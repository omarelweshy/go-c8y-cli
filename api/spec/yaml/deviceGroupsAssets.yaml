# yaml-language-server: $schema=../schema.json
---
information:
  name: devicegroups/assets
  description: Cumulocity device groups assets
  descriptionLong: 'Manage child assets in devicegroups'
  link: https://cumulocity.com/guides/reference/inventory/

endpoints:
  - name: assignAsset
    description: 'Assign asset to group'
    descriptionLong: 'Assigns an asset to a group. The device will be a childAsset of the group'
    method: POST
    path: inventory/managedObjects/{id}/childAssets
    accept: application/vnd.com.nsn.cumulocity.managedObjectReference+json
    collectionType: application/vnd.com.nsn.cumulocity.managedObject+json
    collectionProperty: managedObject
    alias:
        go: assign
        powershell: Add-ChildAssetToDeviceGroup
    examples:
        powershell:
          - description: Add a device to a group
            command: Add-ChildAssetToDeviceGroup -Group $Group.id -Child $Device.id
            skipTest: true
          
          - description: Add a device to a group by passing device and groups instead of an id or name
            command: Add-ChildAssetToDeviceGroup -Group $Group -Child $Device
            skipTest: true

          - description: |
              Add multiple devices to a group. Alternatively `Get-DeviceCollection` can be used
              to filter for a collection of devices and assign the results to a single group.
            command: Get-Device $Device1.name, $Device2.name | Add-ChildAssetToDeviceGroup -Group $Group.id
            skipTest: true
        go:
          - description: Add a device to a group
            command: c8y devicegroups assets assign --group 12345 --child 43234
          
          - description: Add multiple devices to a group
            command: c8y devicegroups assets assign --group 12345 --child 43234,99292,12222

          - description: Add multiple devices to a group (using pipeline)
            command: c8y devices list | c8y devicegroups assets assign --group 12345
            skipTest: true
          
          - description: Add device by name (using pipeline)
            command: c8y devices get --id device01 | c8y devicegroups assets assign --group 12345
            skipTest: true

    pathParameters:
      - name: group
        type: '[]devicegroup'
        property: id
        required: true
        description: Group
    body:
      - name: child
        type: '[]id'
        required: true
        pipeline: true
        pipelineAliases:
          - "deviceId"
          - "source.id"
          - "managedObject.id"
          - "id"
        property: 'managedObject.id'
        description: New device to be added to the group as an child asset

  - name: unassignAsset
    description: Unassign asset from group
    descriptionLong: Unassign/delete an asset from a group
    method: DELETE
    path: inventory/managedObjects/{group}/childAssets/{child}
    accept: ''
    skip: false
    alias:
        go: unassign
        powershell: Remove-DeviceFromGroup
    examples:
      powershell:
        - description: Unassign a child device from its parent asset
          beforeEach:
            - $Group = PSc8y\New-TestDeviceGroup
            - $ChildDevice = PSc8y\New-TestDevice
            - PSc8y\Add-ChildAssetToDeviceGroup -Id $Group.id -Child $ChildDevice.id
          command: Remove-DeviceFromGroup -Group $Group.id -Child $ChildDevice.id
          afterEach:
            - PSc8y\Remove-ManagedObject -Id $ChildDevice.id
            - PSc8y\Remove-ManagedObject -Id $Group.id

      go:
        - description: Unassign a child device from its parent device
          command: c8y devicegroups assets unassign --group 12345 --child 22553
    pathParameters:
      - name: group
        type: '[]devicegroup'
        required: true
        description: Device group

      - name: child
        type: '[]device'
        property: child
        pipeline: true
        pipelineAliases:
          - "deviceId"
          - "source.id"
          - "managedObject.id"
          - "id"
        required: true
        description: Child device

  - name: getChildDevice
    description: Get child device reference
    descriptionLong: Get managed object child device reference
    method: GET
    path: inventory/managedObjects/{group}/childAssets/{child}
    accept: application/vnd.com.nsn.cumulocity.managedObjectReference+json
    alias:
        go: get
        powershell: Get-DeviceGroupChildAsset
    examples:
        powershell:
          - description: Get an existing child asset reference
            command: Get-DeviceGroupChildAsset -Group $Agent.id -Child $Ref.id
            skipTest: true
        go:
          - description: Get an existing child asset reference
            command: c8y devicegroups assets get --group 12345 --child 12345
    pathParameters:
      - name: group
        type: '[]devicegroup'
        pipeline: true
        required: true
        description: Asset id

      - name: child
        type: '[]device'
        property: child
        required: true
        description: Asset reference id

  - name: listChildAssets
    description: Get child assets collection
    descriptionLong: Get a collection of managedObjects child assets
    method: GET
    path: inventory/managedObjects/{group}/childAssets
    accept: application/vnd.com.nsn.cumulocity.managedObjectReferenceCollection+json
    collectionType: application/vnd.com.nsn.cumulocity.managedObject+json
    collectionProperty: 'references.#.managedObject'
    alias:
        go: list
        powershell: Get-DeviceGroupChildAssetCollection
    examples:
      powershell:
        - description: Get a list of the child assets of an existing device
          command: Get-DeviceGroupChildAssetCollection -Id $Group.id
          skipTest: true
      go:
        - description: Get a list of the child devices of an existing device
          command: c8y devicegroups assets list --group 12345
    pathParameters:
      - name: group
        type: '[]devicegroup'
        pipeline: true
        required: true
        description: Device group

    queryParameters:
      - name: query
        description: Query expression group
        property: query
        type: queryExpression
        children:
          - name: query
            type: string
            description: Additional query filter
            format: (%s)
          
          - name: queryTemplate
            type: string
            description: String template to be used when applying the given query. Use %s to reference the query/pipeline input
          
          - name: orderBy
            type: string
            description: Order by. e.g. _id asc or name asc or creationTime.date desc

      - name: withChildren
        type: boolean
        description: Determines if children with ID and name should be returned when fetching the managed object.
