# yaml-language-server: $schema=https://raw.githubusercontent.com/reubenmiller/commander/feat/handle-nested-files/schema.json

config:
  env:
    C8Y_SETTINGS_DEFAULTS_CACHE: true
    C8Y_SETTINGS_CACHE_METHODS: GET POST PUT
    C8Y_SETTINGS_DEFAULTS_CACHETTL: 100h
    C8Y_SETTINGS_DEFAULTS_DRY: true
    C8Y_SETTINGS_DEFAULTS_DRY_FORMAT: json

tests:
  It supports subcommands:
    command: c8y kitchensink features
    exit-code: 0

  lookup addDeviceGroup:
    command: |
      c8y kitchensink features lookup --devicegroup "My Group"
    stdout:
      json:
        body.devicegroup: r/^\d+$

  lookup application:
    command: |
      c8y kitchensink features lookup --application cockpit
    stdout:
      json:
        body.application: r/^\d+$

  lookup applicationname:
    command: |
      c8y kitchensink features lookup --applicationname cockpit
    stdout:
      json:
        body.applicationname: cockpit

  lookup agent:
    command: |
      c8y kitchensink features lookup --agent agent01
    stdout:
      json:
        body.agent: r/^\d+$

  lookup device:
    command: |
      c8y kitchensink features lookup --device device01
    stdout:
      json:
        body.device: r/^\d+$

  lookup deviceprofile:
    command: |
      c8y kitchensink features lookup --deviceprofile profile01
    stdout:
      json:
        body.deviceprofile: r/^\d+$

  lookup tenantname:
    command: |
      c8y kitchensink features lookup --tenantname $C8Y_TENANT
    stdout:
      json:
        body.tenantname: r/^$C8Y_TENANT$

  lookup role:
    command: |
      c8y kitchensink features lookup --role "ROLE_ALARM_REA*"
    stdout:
      json:
        body.role: ROLE_ALARM_READ

  lookup roleself:
    command: |
      c8y kitchensink features lookup --roleself "ROLE_ALARM_REA*"
    stdout:
      json:
        body.roleself: r/^https://.+/user/roles/ROLE_ALARM_READ$

  lookup source:
    command: |
      echo "1\n2" | c8y kitchensink features lookup --source - | c8y util show --select body.source -o csv
    stdout:
      exactly: |
        1
        2

  data id:
    command: |
      c8y kitchensink features idslices --id 1,2 3 4 5
    stdout:
      json:
        body.id.0: "1"
        body.id.1: "2"
        body.id.2: "3"
        body.id.3: "4"
        body.id.4: "5"
